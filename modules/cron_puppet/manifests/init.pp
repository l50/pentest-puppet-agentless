class cron_puppet {
  case $::osfamily {
    'Debian': {
      exec { "apt-update":
        command => "/usr/bin/apt-get update"
      }
    }
  } ->

  file { 'post-hook':
    ensure  => present,
    path    => '/etc/puppet/.git/hooks/post-merge',
    source  => 'puppet:///modules/cron_puppet/post-merge',
    mode    => '0755',
    owner   => root,
    group   => root,
  }

  cron { 'puppet-apply':
    ensure  => present,
    command => "cd /etc/puppet ; /usr/bin/git pull",
    user    => root,
    minute  => '*/30',
    require => File['post-hook'],
  }
}
