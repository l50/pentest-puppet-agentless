#!/bin/bash -e

## Install Git and Puppet
apt-get update
apt-get -y install git-core puppet

# Clone the 'puppet' repo
cd /etc
mv puppet/ puppet-bak
git clone http://github.com/l50/puppet-pentest-agentless.git /etc/puppet

# Install librarian puppet for module management sanity
gem install librarian-puppet --no-ri --no-rdoc

# Install modules using librarian puppet
cd /etc/puppet && librarian-puppet install

# Run Puppet initially to set up the auto-deploy mechanism
puppet apply /etc/puppet/manifests/site.pp
